å¥½çš„ï¼Œè¿™æ˜¯æ•´åˆäº†æ‰€æœ‰ä¿®æ”¹ï¼ŒåŒ…æ‹¬â€œåŠ è½½ä¸­â€æç¤ºåŠŸèƒ½çš„å®Œæ•´ HTML ä»£ç ã€‚
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MallChain - é“¾ä¸Šå•†åŸ</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background-color: #f5f5f5;
    color: #333;
    transition: background-color 0.3s, color 0.3s;
  }

  .navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 60px;
    background-color: #2c2c2c;
    color: #ff6b6b;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    font-size: 20px;
    font-weight: bold;
    z-index: 100;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    transition: background-color 0.3s, color 0.3s;
  }

  .theme-toggle {
    cursor: pointer;
    font-size: 16px;
    padding: 5px 10px;
    border: 1px solid #fff;
    border-radius: 5px;
    background-color: rgba(255,255,255,0.1);
    transition: background-color 0.3s, color 0.3s;
  }

  .content {
    padding: 70px 20px 40px; 
  }

  /* === æ–°å¢ï¼šåŠ è½½ä¸­æ ·å¼ === */
  .loading-message {
    text-align: center;
    padding: 50px 0;
    font-size: 18px;
    color: #666;
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse {
    0% { opacity: 0.5; }
    50% { opacity: 1; }
    100% { opacity: 0.5; }
  }
  /* ====================== */

  .category-title {
    font-size: 22px;
    font-weight: bold;
    margin: 20px 0 10px;
    color: #2c2c2c;
    position: relative;
    padding-left: 12px;
  }

  .category-title::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background-color: #2c2c2c;
    border-radius: 2px;
  }

  .link-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 15px;
  }

  .link-item, .link-forum { 
    position: relative;
    display: flex;
    align-items: center;
    background-color: #fff;
    border-radius: 12px;
    overflow: hidden;
    text-decoration: none; /* ç§»é™¤ä¸‹åˆ’çº¿ */
    color: #333;
    transition: box-shadow 0.3s, background-color 0.3s, color 0.3s;
    padding: 12px;
  }

  .link-item:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .link-img {
    width: 80px;
    height: 80px;
    flex-shrink: 0;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    margin-right: 12px;
    background-color: #ccc;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
  }

  .link-img img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 12px;
    display: block;
  }

  .link-img .fallback-text {
    position: absolute;
    font-size: 12px;
    font-weight: bold;
    color: #555;
    display: none;
    text-align: center;
  }

  .link-info {
    flex: 1;
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding-right: 70px; /* ç»™ä»·æ ¼å’Œè¯¦æƒ…é¢„ç•™ç©ºé—´ */
  }

  .link-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 5px;
    color: #ff6b6b; /* å•†å“æ ‡é¢˜é†’ç›®é¢œè‰² - æ—¥é—´æ¨¡å¼ */
  }

  .link-summary {
    font-size: 14px;
    color: #666;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 10px;
    padding-right: 5px; 
  }

  .link-price {
    position: absolute;
    top: 15px;
    right: 15px;
    font-weight: bold;
    color: #e53935;
    transition: color 0.3s;
  }

  .link-detail {
    position: absolute; 
    bottom: 1px;
    right: 15px;
    font-size: 16px; 
    font-weight: bold; 
    color: #2c2c2c;
    cursor: pointer;
    transition: color 0.3s;
  }

  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background-color: #fff;
    padding: 20px 30px;
    border-radius: 12px;
    max-width: 400px;
    width: 80%;
    text-align: center;
    position: relative;
    transition: background-color 0.3s, color 0.3s;
  }
  
  /* === æ¨¡æ€æ¡†å†…é“¾æ¥æ ·å¼ === */
  .modal-content a {
    text-decoration: none; 
    color: #ff6b6b;        
    font-weight: bold;
    transition: color 0.3s;
  }
  /* =========================== */

  .modal-close {
    position: absolute;
    top: 10px; right: 15px;
    cursor: pointer;
    font-size: 18px;
    font-weight: bold;
  }

  .footer {
    margin-top: 40px;
    text-align: center;
    font-size: 14px;
    color: #888;
  }

  /* å¤œé—´æ¨¡å¼ */
  body.dark-mode {
    background-color: #121212;
    color: #ddd;
  }
  body.dark-mode .navbar { background-color: #1e1e1e; }
  body.dark-mode .theme-toggle { border-color:#fff; color:#fff; background-color:rgba(255,255,255,0.1);}
  body.dark-mode .category-title { color:#ffffff;}
  body.dark-mode .category-title::before { background-color:#ffffff;}
  body.dark-mode .link-item, body.dark-mode .link-forum { background-color:#1e1e1e; color:#ddd;}
  body.dark-mode .link-title { color:#ff6b6b;} /* å•†å“æ ‡é¢˜é†’ç›®é¢œè‰² - å¤œé—´æ¨¡å¼ */
  body.dark-mode .link-summary { color:#aaa;}
  body.dark-mode .link-price { color:#ff6b6b;}
  body.dark-mode .link-detail { color:#ffffff;}
  body.dark-mode .modal-content { background-color:#1e1e1e; color:#ddd;}
  
  /* === å¤œé—´æ¨¡å¼ä¸‹æ¨¡æ€æ¡†å†…é“¾æ¥æ ·å¼ === */
  body.dark-mode .modal-content a {
    color: #ff6b6b; 
  }
  /* =========================== */
  body.dark-mode .loading-message {
    color: #aaa;
  }

  body.dark-mode .footer { color:#aaa;}
</style>


</head>
<body>

<div class="navbar">
  MallChain é“¾ä¸Šå•†åŸ
  <span class="theme-toggle" id="themeToggle">ğŸŒ™</span>
</div>

<div class="content" id="productContent">
  <p class="loading-message" id="loadingMessage">
    ğŸ›’ æ­£åœ¨åŠ è½½é“¾ä¸Šå•†å“æ•°æ®...
  </p>
</div>

<div class="footer">
  Â© 2025 MallChain.io é“¾ä¸Šå•†åŸ
  <br>
  <span id="visitorCount">ä½ æ˜¯ç¬¬ ... ä¸ªè®¿é—®æˆ‘ä»¬çš„ç½‘ç«™</span>
</div>

<div class="modal" id="detailModal">
  <div class="modal-content">
    <span class="modal-close" id="modalClose">&times;</span>
    <h3 id="modalTitle"></h3>
    <p id="modalPrice"></p>
    <p id="modalDetail"></p>
  </div>
</div>

<script>
  // è®¿é—®è®¡æ•°å™¨
  fetch('https://forum.mallchain.io/tj.php')
    .then(res => res.text())
    .then(data => {
      document.getElementById('visitorCount').textContent = `ä½ æ˜¯ç¬¬ ${data} ä¸ªè®¿é—®æˆ‘ä»¬çš„ç½‘ç«™`;
    })
    .catch(err => console.error(err));

  // --- å•†å“åˆ—è¡¨åŠ¨æ€åŠ è½½é€»è¾‘ ---

  // ä¸»å®¹å™¨å’ŒåŠ è½½æç¤ºå…ƒç´ 
  const productContent = document.getElementById('productContent');
  let loadingMessage = document.getElementById('loadingMessage'); // ä½¿ç”¨ let æ–¹ä¾¿åœ¨ loadProducts ä¸­é‡æ–°è·å–

  /**
   * åˆ›å»ºå•ä¸ªå•†å“é¡¹çš„ HTML ç»“æ„
   * @param {Object} product - å•†å“æ•°æ®å¯¹è±¡
   * @returns {string} - å•†å“é¡¹çš„ HTML å­—ç¬¦ä¸²
   */
  function createProductHTML(product) {
    const linkClass = product.type === 'forum' ? 'link-forum' : 'link-item';
    const linkHref = product.url || '#'; // é»˜è®¤ä½¿ç”¨ #
    
    // å®‰å…¨åœ°å­˜å‚¨è¯¦æƒ…å†…å®¹
    return `
      <a href="${linkHref}" class="${linkClass}" data-detail="${product.detail.replace(/"/g, '&quot;').replace(/\n/g, '<br>')}" data-price="${product.price}">
        <div class="link-img">
          <img src="${product.img_url}" alt="${product.title}">
          <span class="fallback-text">MallChain</span>
        </div>
        <div class="link-info">
          <div>
            <div class="link-title">${product.title}</div>
            <div class="link-summary">${product.summary}</div>
          </div>
          <div>
            <div class="link-price">${product.price}</div>
            <div class="link-detail">è¯¦æƒ…</div>
          </div>
        </div>
      </a>
    `;
  }

  /**
   * æ¸²æŸ“å•†å“æ•°æ®åˆ°é¡µé¢
   * @param {Array<Object>} products - å•†å“æ•°ç»„
   */
  function renderProducts(products) {
    // 1. ç§»é™¤åŠ è½½æç¤º
    const currentLoading = document.getElementById('loadingMessage');
    if (currentLoading) {
        currentLoading.remove();
    }
    
    // 2. æŒ‰åˆ†ç±»å¯¹å•†å“è¿›è¡Œåˆ†ç»„
    const groupedProducts = products.reduce((acc, product) => {
      const category = product.category || 'æœªåˆ†ç±»';
      if (!acc[category]) {
        acc[category] = [];
      }
      acc[category].push(product);
      return acc;
    }, {});

    // 3. éå†åˆ†ç»„ï¼Œç”Ÿæˆåˆ†ç±»å’Œåˆ—è¡¨çš„ HTML
    let finalHTML = '';
    for (const category in groupedProducts) {
      const linkListHTML = groupedProducts[category]
        .map(createProductHTML)
        .join('');

      const categoryHTML = `
        <div class="category">
          <div class="category-title">${category}</div>
          <div class="link-list">
            ${linkListHTML}
          </div>
        </div>
      `;
      finalHTML += categoryHTML;
    }

    // 4. æ’å…¥åˆ°é¡µé¢
    productContent.innerHTML = finalHTML;
    
    // 5. é‡æ–°ç»‘å®šè¯¦æƒ…ç‚¹å‡»äº‹ä»¶å’Œå›¾ç‰‡åŠ è½½å¤„ç†
    bindEvents();
  }

  /**
   * ä» sp.php åŠ è½½å•†å“æ•°æ®
   */
  function loadProducts() {
    // ç¡®ä¿åŠ è½½æç¤ºå¯è§
    productContent.innerHTML = `<p class="loading-message" id="loadingMessage">ğŸ›’ æ­£åœ¨åŠ è½½é“¾ä¸Šå•†å“æ•°æ®...</p>`;
    loadingMessage = document.getElementById('loadingMessage'); // é‡æ–°è·å–å¼•ç”¨
    
    fetch('https://forum.mallchain.io/sp.php')
      .then(response => {
        if (!response.ok) {
          throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥: ' + response.statusText);
        }
        return response.json();
      })
      .then(data => {
        if (Array.isArray(data)) {
          renderProducts(data);
        } else {
          // ç§»é™¤åŠ è½½æç¤ºï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
          productContent.innerHTML = '<p style="text-align:center; color:red; padding: 50px 0;">å•†å“æ•°æ®æ ¼å¼é”™è¯¯ã€‚</p>';
        }
      })
      .catch(error => {
        console.error('åŠ è½½å•†å“å¤±è´¥:', error);
        // ç§»é™¤åŠ è½½æç¤ºï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        productContent.innerHTML = `<p style="text-align:center; color:red; padding: 50px 0;">æ— æ³•åŠ è½½å•†å“åˆ—è¡¨ã€‚é”™è¯¯ä¿¡æ¯: ${error.message}</p>`;
      });
  }

  // é¡µé¢åŠ è½½å®Œæˆåç«‹å³è°ƒç”¨
  document.addEventListener('DOMContentLoaded', loadProducts);

  // --- æ¨¡æ€æ¡†å’Œä¸»é¢˜åˆ‡æ¢é€»è¾‘ ---

  const modal = document.getElementById('detailModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalPrice = document.getElementById('modalPrice');
  const modalDetail = document.getElementById('modalDetail');
  const modalClose = document.getElementById('modalClose');

  function bindEvents() {
    // 1. ç»‘å®šè¯¦æƒ…ç‚¹å‡»äº‹ä»¶
    const detailButtons = document.querySelectorAll('.link-item, .link-forum');

    detailButtons.forEach(btn => {
      btn.onclick = (e) => { 
        // é˜»æ­¢é»˜è®¤è·³è½¬è¡Œä¸º
        e.preventDefault(); 
        
        // è·å–çˆ¶å…ƒç´ çš„æ•°æ®
        const parent = btn; 
        
        // å¡«å……æ¨¡æ€æ¡†å†…å®¹
        modalTitle.textContent = parent.querySelector('.link-title').textContent;
        modalPrice.textContent = parent.dataset.price;
        // ä½¿ç”¨ innerHTML è®¾ç½®è¯¦æƒ…å†…å®¹å¹¶åè½¬ä¹‰
        modalDetail.innerHTML = parent.dataset.detail.replace(/&quot;/g, '"').replace(/&amp;/g, '&');
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        modal.style.display = 'flex';
      };
    });

    // 2. å›¾ç‰‡åŠ è½½å¤„ç†
    document.querySelectorAll('.link-img').forEach(container => {
      const img = container.querySelector('img');
      const text = container.querySelector('.fallback-text');
      if(img) {
        img.onerror = () => { 
          img.style.display='none'; 
          if(text) { 
            text.style.display='flex'; 
            text.style.alignItems='center'; 
            text.style.justifyContent='center'; 
          } 
        };
        // æ£€æŸ¥å›¾ç‰‡æ˜¯å¦å·²åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶åŠ è½½å¤±è´¥
        if (img.complete && img.naturalHeight === 0) {
            img.onerror();
        }
      } else {
        if(text) { text.style.display='flex'; text.style.alignItems='center'; text.style.justifyContent='center'; }
      }
    });
  }
  
  // æ¨¡æ€æ¡†å…³é—­äº‹ä»¶
  modalClose.addEventListener('click', () => modal.style.display = 'none');
  window.addEventListener('click', e => { if(e.target === modal) modal.style.display = 'none'; });

  // ä¸»é¢˜åˆ‡æ¢äº‹ä»¶
  const themeToggle = document.getElementById('themeToggle');
  themeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    themeToggle.textContent = document.body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ğŸŒ™';
  });
</script>

</body>
</html>

